# Подробный план решения задачи SWE-bench Data Point Validator

## Обзор задачи

Необходимо создать систему валидации для SWE-bench data points, которая будет проверять корректность исправлений (patches) с использованием официального evaluation harness SWE-bench. Система должна интегрироваться с GitHub Actions для автоматической валидации при изменениях в папке `data_points/`.

## Этап 1: Документация SWE-bench Docker архитектуры

### 1.1 Исследование Docker архитектуры
- [ ] Изучить официальную документацию SWE-bench по Docker
- [ ] Проанализировать 3-слойную систему Docker образов:
  - Base images (базовые образы с системными зависимостями)
  - Environment images (образы с зависимостями проектов)  
  - Instance images (образы для конкретных тестовых случаев)
- [ ] Понять процесс построения образов и установки зависимостей

### 1.2 Создание документации
- [ ] Создать файл `swe-bench-docker-architecture.md`
- [ ] Описать архитектуру Docker системы
- [ ] Документировать процесс выполнения тестов
- [ ] Добавить конкретные примеры выполнения
- [ ] Описать интеграционные точки с валидатором

**Deliverable**: `swe-bench-docker-architecture.md` (100-300 строк)

## Этап 2: Реализация валидатора SWE-bench

### 2.1 Архитектура валидатора
- [ ] Создать модуль `swe_bench_validator/`
- [ ] Структура модулей:
  - `__init__.py` - публичный API
  - `validator.py` - основная логика валидации
  - `cli.py` - интерфейс командной строки
  - `utils.py` - вспомогательные функции
  - `config.py` - конфигурация валидации

### 2.2 Основная функциональность
- [ ] **Загрузка data points**: Чтение JSON файлов из папки `data_points/`
- [ ] **Преобразование в формат предсказаний**: Конвертация в формат SWE-bench predictions
- [ ] **Запуск evaluation harness**: Использование `swebench.harness.run_evaluation`
- [ ] **Валидация результатов**: Проверка что тесты `FAIL_TO_PASS` и `PASS_TO_PASS` проходят

### 2.3 Обработка ошибок и таймауты
- [ ] **Структурные ошибки**: Некорректный JSON, отсутствующие поля
- [ ] **Ошибки выполнения**: Docker ошибки, сбои тестов
- [ ] **Таймауты**: Настраиваемые таймауты для разных типов data points
- [ ] **Детальные сообщения об ошибках**: Понятные и действенные сообщения

### 2.4 CLI интерфейс
- [ ] Команда валидации конкретного файла
- [ ] Команда валидации всей папки
- [ ] Команда валидации только измененных файлов
- [ ] Опции для настройки таймаутов и уровня детализации

**Deliverable**: Рабочий Python валидатор с CLI интерфейсом

## Этап 3: GitHub Action workflow

### 3.1 Создание workflow файла
- [ ] Создать `.github/workflows/validate-datapoints.yml`
- [ ] Настроить триггеры:
  - Push в `data_points/**`
  - Pull requests затрагивающие `data_points/**`

### 3.2 Оптимизация производительности
- [ ] **Детекция изменений**: Определение только измененных/новых файлов
- [ ] **Параллельная валидация**: Если возможно, валидировать файлы параллельно
- [ ] **Кэширование**: Кэширование Docker образов и зависимостей

### 3.3 Отчетность и статусы
- [ ] **Status checks**: Зеленые/красные статусы для PR
- [ ] **Детальные логи**: Подробная информация об ошибках
- [ ] **Комментарии в PR**: Автоматические комментарии с результатами

**Deliverable**: `.github/workflows/validate-datapoints.yml`

## Этап 4: Интеграция с проектом

### 4.1 Обновление конфигурации проекта
- [ ] Добавить зависимости валидатора в `pyproject.toml`
- [ ] Обновить структуру пакетов в `setuptools.packages.find`
- [ ] Добавить dev зависимости для тестирования

### 4.2 Документация пользователя
- [ ] Обновить `README.md` с инструкциями по использованию
- [ ] Добавить примеры использования валидатора
- [ ] Документировать процесс добавления новых data points

**Deliverable**: Обновленная конфигурация проекта и документация

## Этап 5: Тестирование и демонстрация

### 5.1 Локальное тестирование
- [ ] Протестировать валидатор на существующих data points
- [ ] Убедиться что валидная точка (`astropy__astropy-11693.json`) проходит валидацию
- [ ] Убедиться что невалидная точка (`astropy__astropy-11693-fail.json`) не проходит валидацию

### 5.2 Создание публичного репозитория
- [ ] Создать новый публичный репозиторий с реализацией
- [ ] Перенести весь код и конфигурацию
- [ ] Настроить GitHub Actions в новом репозитории

### 5.3 Создание тестовых Pull Requests
- [ ] **PR #1 (валидный)**: 
  - Добавить валидную data point
  - Показать зеленые status checks
  - Продемонстрировать успешную валидацию
- [ ] **PR #2 (невалидный)**:
  - Добавить невалидную data point  
  - Показать красные status checks
  - Продемонстрировать четкие сообщения об ошибках

**Deliverable**: Публичный репозиторий с двумя демонстрационными PR

## Технические требования

### Языки и инструменты
- **Python 3.10+** с UV package manager
- **SWE-bench library** для evaluation harness
- **Docker** для выполнения тестов
- **GitHub Actions** для CI/CD

### Зависимости
- `swebench>=4.0.4` - официальная библиотека SWE-bench
- `click` - для CLI интерфейса
- `rich` - для красивого вывода
- `pytest` - для тестирования (dev зависимость)

### Производительность и надежность
- **Таймауты**: Настраиваемые таймауты для предотвращения зависания
- **Обработка ошибок**: Graceful handling Docker ошибок и сбоев тестов
- **Оптимизация**: Валидация только измененных файлов в CI/CD

## Критерии успеха

1. **Документация**: Полная и понятная документация Docker архитектуры
2. **Функциональность**: Валидатор корректно определяет валидные и невалидные data points
3. **Интеграция**: GitHub Action работает автоматически при изменениях
4. **Демонстрация**: Два PR показывают работу системы в реальных условиях
5. **Качество кода**: Чистый, хорошо структурированный и документированный код

## Временные оценки

- **Этап 1** (Документация): 1.5 часа
- **Этап 2** (Валидатор): 2.5 часа  
- **Этап 3** (GitHub Action): 1 час
- **Этап 4** (Интеграция): 0.5 часа
- **Этап 5** (Тестирование): 1 час

**Общее время**: ~6 часов (соответствует оценке задания)

## Порядок выполнения

1. Начать с документации Docker архитектуры для понимания системы
2. Реализовать core валидатор с CLI интерфейсом
3. Создать и протестировать GitHub Action локально
4. Интегрировать все компоненты и обновить документацию
5. Создать публичный репозиторий и демонстрационные PR

Этот план обеспечивает систематический подход к решению задачи с четкими deliverables и критериями успеха на каждом этапе.
